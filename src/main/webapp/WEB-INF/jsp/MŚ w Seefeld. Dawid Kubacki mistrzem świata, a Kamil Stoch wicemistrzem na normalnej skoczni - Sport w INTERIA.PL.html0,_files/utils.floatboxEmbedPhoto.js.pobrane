var utils=utils||{};utils.floatboxEmbedPhoto=function(a){var b=!1,c=!1;return Loader=function(){var a={box:""},b=function(){return'<div class="floatbox-loader"><div class="amp1"></div><div class="amp2"></div><div class="amp3"></div><div class="amp4"></div><div class="amp5"></div></div>'};return{insert:function(c){a.box=jQuery(b()).appendTo(c)},on:function(){a.box.show()},off:function(){a.box.hide()}}}(),Closer=function(){var a={box:""},b=function(){return'<div class="floatbox-close" title="Zamknij podgląd"></div>'};return{insert:function(c){a.box=jQuery(b()).appendTo(c)},switchOn:function(b){a.box.on("click touchstart",b)}}}(),Scroll=function(){var a={box:""},b=function(){return'<div class="floatbox-scroll"></div>'};return{insert:function(c){var d=jQuery(b());a.box=d.appendTo(c)},on:function(){a.box.attr({class:"floatbox-scroll js-scroll-show"})},off:function(){a.box.attr({class:"floatbox-scroll js-scroll-hide"}),a.box.css({height:"30px"})},height:function(b){a.box.css({height:b+"px"})},pos:function(b){a.box.css({top:b+"px"})}}}(),Details=function(){var a={box:"",description:"",alt:""},b=!1,c=function(b){var c=jQuery('<div class="floatbox-detail"></div>');a.more=jQuery('<span class="floatbox-detail-more">czytaj więcej</span>').appendTo(c),a.content=jQuery('<div class="floatbox-detail-content"></div>'),a.description=jQuery('<p class="floatbox-detail-description"></p>').appendTo(a.content),a.alt=jQuery('<p class="floatbox-detail-alt"></p>').appendTo(a.content),a.source=jQuery('<span class="floatbox-detail-source"></span>').appendTo(a.content),a.author=jQuery('<span class="floatbox-detail-author"></span>').appendTo(a.content),a.caption=jQuery('<span class="floatbox-detail-caption"></span>').appendTo(a.content),Scroll.insert(a.content),a.content=a.content.appendTo(c),a.box=jQuery(c).appendTo(b),a.more.on("click touchstart",showAll)};return rollUp=function(){a.box.attr({class:"floatbox-detail rollup"}),Scroll.off(),a.box.scrollTop(0),a.more.removeClass("static"),a.more.css({top:"0px"})},scroller=function(){var b,c=getContentHeight(),d=50,e=getHeight()-d;if(console.info(c,e-24,getHeight(),a.content.height(),a.box.height()),a.content.height()>a.box.height()-d-24){var f,g,h=Helper.calcRound(100*e/c);c-e>h/2?(f=c-e-h/2,g=e-h):(f=c-e,g=e),a.more.addClass("static"),a.more.css({top:"0px"}),Scroll.height(h),Scroll.on(),b=c-h,a.box.on("scroll",function(c){var e,h=parseInt(c.target.scrollTop,10);if(a.more.css({top:h+"px"}),(e=h+d+h*Helper.calcRound(g/f))>=b)return Scroll.pos(b),void c.preventDefault();Scroll.pos(e)})}else Scroll.off(),a.more.removeClass("static"),a.more.css({top:"0px"})},rollDown=function(){a.box.attr({class:"floatbox-detail rolldown"}),scroller()},resetRoll=function(){a.box.attr({class:"floatbox-detail"}),Scroll.off(),a.more.removeClass("static"),a.more.css({top:"0px"})},showAll=function(a){!1===b?(b=!0,rollUp()):(b=!1,rollDown())},setHeight=function(b){return a.box.height(b)},getHeight=function(){return a.box.outerHeight()},getContentHeight=function(){return a.content.outerHeight()},resetHeight=function(){a.box.attr({style:""}),a.box.scrollTop(0),a.more.removeClass("static"),a.more.css({top:"0px"})},{insert:function(a){c(a)},render:function(b){a.description.html(b.title),b.alt==b.title&&(b.alt=""),a.alt.html(b.alt),b.alt==b.source&&(b.source=""),a.source.html(b.source),b.alt==b.author&&(b.author=""),a.author.html(b.author),b.alt==b.caption&&(b.caption=""),a.caption.html(b.caption),resetRoll()},getHeight:function(){return parseInt(a.box.outerHeight(),10)},setHeight:setHeight,rollUp:rollUp,rollDown:rollDown,resetRoll:resetRoll,resetHeight:resetHeight}}(),Screen=function(){var a={box:""},b=function(){return'<div class="floatbox-screen"></div>'};return switchOn=function(b){a.box.on("click touchstart",b)},{insert:function(d){var e=jQuery(b());Loader.insert(e),a.box=e.appendTo(d),Loader.on(),switchOn(function(){c=!1,Wrapper.off(),Screen.off(),ContentObject.remove()})},on:function(){a.box.show()},off:function(){a.box.hide()}}}(),ContentObject=function(){var a={box:""},b=function(){return'<div class="js-change-object"></div>'};return{insert:function(c){a.box=jQuery(b()).appendTo(c)},append:function(b){return b.appendTo(a.box)},remove:function(){a.box&&a.box.html("")},setTypeObject:function(b){a.box.attr({class:"js-change-object "+b})},removeTypeObject:function(){a.box.attr({class:"js-change-object"})}}}(),Content=function(){var a={box:""},b=function(){return'<div class="floatbox-content"></div>'},d=function(){return'<div class="floatbox-wrapper-container"></div>'};return{insert:function(e){var f=jQuery(d()),g=jQuery(b());a.box=g.appendTo(f),a.container=f.appendTo(e),ContentObject.insert(g),Details.insert(g),Closer.insert(g),Closer.switchOn(function(){c=!1,Wrapper.off(),Screen.off(),ContentObject.remove()})},on:function(){a.container.show()},off:function(){a.container.hide()},setHeight:function(b){a.container.height(b),a.box.height(b)},setWidth:function(b){a.box.width(b)}}}(),Wrapper=function(){var a={box:""},b=function(){return'<div class="floatbox-wrapper"></div>'};return{insert:function(c){var d=jQuery(b());Content.insert(d),a.box=d.appendTo(c)},on:function(){a.box.removeClass("floatbox-wrapper-hide").addClass("floatbox-wrapper-active")},off:function(){a.box.removeClass("floatbox-wrapper-active").addClass("floatbox-wrapper-hide")}}}(),Helper=function(){var a=function(a){return Math.round(100*(a+1e-5))/100},b=function(b,c){var b=parseInt(b,10),c=parseInt(c,10);return a(c/b)},c=function(b,c){var d,e=window.innerHeight&&window.innerHeight>0?window.innerHeight:document.body.clientHeight;return brwdt=window.innerWidth&&window.innerWidth>0?window.innerWidth:document.body.clientWidth,b>1?(newhgt=.7*e,(d=a(newhgt/b))>brwdt&&(d=.8*brwdt,newhgt=a(d*b))):(brwdt>c&&(brwdt=c),d=.8*brwdt,newhgt=a(d*b),newhgt>e&&(newhgt=.7*e,d=a(newhgt/b))),{width:d,height:newhgt,gapBottom:e-newhgt,window:{width:brwdt,height:e}}};return extendObj=function(a,b){if("object"==typeof a&&"object"==typeof b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a}},addScriptFile=function(a){var b=document.createElement("script"),c=document.getElementsByTagName("script")[0];return b.async=!0,b.src=a,c.parentNode.insertBefore(b,c),b},addCssFile=function(a){var b=document.getElementsByTagName("head")[0],c=document.createElement("link");return c.rel="stylesheet",c.type="text/css",c.href=a,c.media="all",b.appendChild(c),c},{getNewSizeObject:c,getRatio:b,calcRound:a,extendObj:extendObj,addScriptFile:addScriptFile,addCssFile:addCssFile}}(),ImageObject=function(){this.dom={img:null,newImg:null},this.maxWidth=1200,this.params={},this.ratio=0,this.roll=!1},VideoObject=function(){this.dom={box:null,video:null},this.maxWidth=1200,this.player=null,this.params={},this.ratio=0,this.roll=!1},Config=function(a){return{selector:a.selector||".js-embed-quiz-form .photo-image, .js-embed-quiz-result .photo-image",domain:a.domain||""}}(a),List=function(a){jQuery(Config.selector).on("click touchstart",function(b){b.preventDefault(),a({dom:jQuery(this)})}),jQuery(window).one("loadedResultQuiz",function(){jQuery(Config.selector).click(function(b){b.preventDefault(),a({dom:jQuery(this)})})}),jQuery(window).on("message",function(b){if(b=b.originalEvent?b.originalEvent:b,b.origin===Config.domain&&"string"==typeof b.data){try{var c=JSON.parse(b.data)}catch(d){}if("object"==typeof c&&c.type)return"image"==c.type&&c.path&&c.path.length>20?(a({post:c}),!0):!("video"!=c.type||!c.player||(a({post:c}),0))}})},createPostMessage=function(a){jQuery(a.formSelector).find(a.imageSelector).each(function(){jQuery(this).on("click",function(){var b,c={},d=jQuery(this);c.title=d.attr("title"),c.alt=d.attr("alt"),c.source=d.attr("data-source"),c.author=d.attr("data-author"),c.caption=d.attr("data-caption"),c.type=d.attr("data-type"),"image"==c.type?c.path=d.attr("data-image-size"):c.player=JSON.parse(d.attr("data-video-player-params")),b=JSON.stringify(c),window.postMessage&&parent.postMessage(b,a.domain)})})},Manager=function(){var a=function(a){return!!a&&a.attr("data-type")},d=function(d){var e,f;if(!1===b&&(Screen.insert(jQuery("body")),Wrapper.insert(jQuery("body")),b=!0),c=!0,Wrapper.off(),Screen.on(),Loader.on(),ContentObject.remove(),d.post?(e=d.post.type,f="setParamsFromPost"):(e=a(d.dom),f="setParamsFromDom"),"video"==e){var g=new VideoObject;g[f](e,d),g.execute()}else if("image"==e){var h=new ImageObject;h[f](e,d),h.execute()}};return{createPostMessage:createPostMessage,execute:function(){List(d)},isIframe:function(){return window.parent!==window}}}(),ImageObject.prototype=Helper.extendObj(ImageObject.prototype,{createNewImage:function(){var a=this;a.dom.newImg=jQuery(new Image),a.dom.newImg.src=a.params.src,a.dom.newImg.attr({src:a.params.src,title:a.params.title,alt:a.params.alt,class:"img-responsive photo-image"}),this.dom.newImg.one("load",function(){jQuery(window).trigger("loadedImage")}).each(function(){this.complete&&jQuery(window).trigger("loadedImage")})},getImagePath:function(a){var b=window.innerWidth,c={},d=a.split(";;"),e=d.length;if(!(e<1)){for(var f,g=0;g<e;g++)f=d[g].split("::"),2==f.length&&(c[f[0]]=f[1]);var h=this.src;return b>=0&&(h=c.hasOwnProperty("xs")?c.xs:h),b>=480&&(h=c.hasOwnProperty("rs")?c.rs:h),b>=768&&(h=c.hasOwnProperty("sm")?c.sm:h),b>=1e3&&(h=c.hasOwnProperty("md")?c.md:h),b>=1280&&(h=c.hasOwnProperty("lg")?c.lg:h),h}},setImageRatio:function(a){this.ratio=Helper.getRatio(jQuery(a).outerWidth(),jQuery(a).outerHeight())},resize:function(){Details.resetHeight(),Scroll.off();var a=Helper.getNewSizeObject(this.ratio,this.maxWidth);Content.setWidth(a.width),this.dom.newImg.width(a.width-1),this.dom.newImg.height(a.height),parseInt(Details.getHeight(),10)<a.height/3&&!1===this.roll?(Details.resetRoll(),Content.setHeight(a.height)):(Details.rollUp(),Content.setHeight(a.height+25),this.roll=!0)},setParamsFromDom:function(a,b){this.dom={},this.params={},this.dom.img=b.dom,this.params.type=a,this.params.title=this.dom.img.attr("title"),this.params.alt=this.dom.img.attr("alt"),this.params.source=this.dom.img.attr("data-source"),this.params.author=this.dom.img.attr("data-author"),this.params.caption=this.dom.img.attr("data-caption"),this.params.src=this.getImagePath(this.dom.img.attr("data-image-size"))},setParamsFromPost:function(a,b){this.params={};var b=b.post;this.params.type=a,this.params.title=b.title,this.params.alt=b.alt,this.params.source=b.source,this.params.author=b.author,this.params.caption=b.caption,this.params.src=this.getImagePath(b.path)},execute:function(){var a=this;a.createNewImage(),Details.render(a.params),jQuery(window).one("loadedImage",function(){a.dom.newImg=ContentObject.append(a.dom.newImg),ContentObject.setTypeObject("floatbox-photo"),Wrapper.on(),Loader.off(),a.setImageRatio(a.dom.newImg),a.resize(),void 0!==jQuery.fn.lazyresize&&jQuery(window).lazyresize(function(){c&&a.resize()},500)})}}),VideoObject.prototype=Helper.extendObj(VideoObject.prototype,{getHtml:function(a){return'<div class="floatbox-video-box"><div class="floatbox-video-player" id="'+a+'"></div></div>'},setNewVideo:function(){if(this.dom.box=jQuery(this.getHtml(this.params.player.elId)),this.dom.video=ContentObject.append(this.dom.box),ContentObject.setTypeObject("floatbox-video"),void 0===Inpl.Video){var a=(Helper.addCssFile(this.params.player.basepath+"theme/"+this.params.player.theme+"/s.css"),Helper.addScriptFile(this.params.player.basepath+"inpl.videoplayer.js")),b=this;a.onload=function(){Inpl.Video.hasInstance(b.params.player.elId)&&Inpl.Video.removeInstance(b.params.player.elId),b.player=Inpl.Video.createInstance(b.params.player),b.player.on("ready",function(){jQuery(window).trigger("loadedVideo")})}}else Inpl.Video.hasInstance(this.params.player.elId)&&Inpl.Video.removeInstance(this.params.player.elId),this.player=Inpl.Video.createInstance(this.params.player),this.player.on("ready",function(){jQuery(window).trigger("loadedVideo")})},setVideoRatio:function(){var a=this.player.getContainer();this.ratio=a.style.paddingBottom?parseInt(a.style.paddingBottom,10)/100:.56},resize:function(){Details.resetHeight(),Scroll.off();var a=Helper.getNewSizeObject(this.ratio,this.maxWidth);Content.setWidth(a.width-1);var b=parseInt(Details.getHeight(),10);a.gapBottom=a.gapBottom-20,b<a.gapBottom&&!1===this.roll&&a.width>768?(Details.resetRoll(),Content.setHeight(a.height+b)):(Details.resetHeight(),Details.rollUp(),Content.setHeight(a.height+25),this.roll=!0)},setParamsFromDom:function(a,b){this.dom.img=b.dom,this.params={},this.params.type=a,this.params.title=this.dom.img.attr("title"),this.params.alt=this.dom.img.attr("alt"),this.params.source=this.dom.img.attr("data-source"),this.params.author=this.dom.img.attr("data-author"),this.params.caption=this.dom.img.attr("data-caption"),this.params.player=JSON.parse(this.dom.img.attr("data-video-player-params"))},setParamsFromPost:function(a,b){var b=b.post;this.params={},this.params.type=a,this.params.title=b.title,this.params.alt=b.alt,this.params.source=b.source,this.params.author=b.author,this.params.caption=b.caption,this.params.player=b.player},execute:function(){var a=this;a.setNewVideo(),Details.render(a.params),jQuery(window).one("loadedVideo",function(){Wrapper.on(),Loader.off(),a.setVideoRatio(),a.resize(),void 0!==jQuery.fn.lazyresize&&jQuery(window).lazyresize(function(){c&&a.resize()},500)})}}),Manager};