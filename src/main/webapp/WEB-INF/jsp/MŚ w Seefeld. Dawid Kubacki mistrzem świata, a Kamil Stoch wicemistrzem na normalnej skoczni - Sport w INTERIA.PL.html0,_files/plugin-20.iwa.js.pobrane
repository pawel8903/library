(window.webpackJsonpIWA=window.webpackJsonpIWA||[]).push([[7],{17:function(e,t,i){"use strict";i.r(t),i.d(t,"default",function(){return r});var s=i(1),n=i(0),o=i(3);class r{constructor(e,t){this.tracker=e,this.conf=t,this.viewThresholdOffset=0,this.scrollThreshold=100,this.isLoaded=!1,this.nodesList=[],this.nodeIdsList=[],this.fnOnScrollDebounce=this.debounce(this.onScroll,this.scrollThreshold),this.isWorking=!1,this.attributeName="data-iwa-viewability-name",this.viewAbilityTime=1e3,this.secondsFactor=.001,this.lastScrollPosY=null,this.browserPrefixes=["moz","ms","o","webkit"],this.isPageVisible=!0,this.browserPrefix=this.getBrowserPrefix(),this.hiddenPropertyName=this.getHiddenPropertyName(this.browserPrefix),this.visibilityEventName=this.getVisibilityEvent(this.browserPrefix),this.fnRequestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}init(){var e=this;new o.a(window).on("load",function(){e.isLoaded||(e.isLoaded=!0,e.observeNodes(),e.handleEvents(),e.updateNodes())})}setInitialProperties(e){const t=e;t.startWidth=t.offsetWidth,t.startHeight=t.offsetHeight,t.oneSecViewCounter=0,t.fullTimeViewCounter=0}handleEvents(){var e=this;this.addEvent(window,"scroll",this.fnOnScrollDebounce.bind(this)),this.addEvent(window,"beforeunload",this.onBeforeUnload.bind(this)),this.addEvent(document,this.visibilityEventName,this.handlePageVisibilityChange.bind(this),!1),this.addEvent(document,"focus",function(){return e.handlePageVisibilityChange.call(e,[!0])},!1),this.addEvent(document,"blur",function(){return e.handlePageVisibilityChange.call(e,[!1])},!1),this.addEvent(window,"focus",function(){return e.handlePageVisibilityChange.call(e,[!0])},!1),this.addEvent(window,"blur",function(){return e.handlePageVisibilityChange.call(e,[!1])},!1)}addEvent(e,t,i){e&&i&&(n.e(e.addEventListener)?e.addEventListener(t,i,!1):n.e(e.attachEvent)&&e.attachEvent(`on${t}`,i))}updateScrollPosY(e){this.lastScrollPosY=e||window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop}isVisible(e){return null!==e.offsetParent}isEmpty(e){if(!n.e(Inpl)||!n.e(Inpl.Ad))return!1;const t=e.getAttribute(this.attributeName),i=0===t.indexOf("ad_")?t.slice(3):t,s=n.e(Inpl.Ad.returnAd)&&n.f(Inpl.Ad.returnAd)?Inpl.Ad.returnAd():{},o=n.e(Inpl.Ad.getAdCodes)&&n.f(Inpl.Ad.getAdCodes)?Inpl.Ad.getAdCodes():{},r=n.e(s)?s[i]:"",a=n.e(o)&&n.e(r)?o[r]:"";return!!n.e(a)&&!!a.isEmpty}offsetTop(e){return e.getBoundingClientRect().top+window.pageYOffset-document.documentElement.clientTop}isAbove(e){return this.lastScrollPosY>=this.offsetTop(e)+this.viewThresholdOffset+e.offsetHeight}isBelow(e){return(window.innerHeight?window.innerHeight:window.offsetHeight)+this.lastScrollPosY<=this.offsetTop(e)-this.viewThresholdOffset}isNearViewport(e){return!this.isAbove(e)&&!this.isBelow(e)}handleAppearedElement(e){var t=this;const i=e;i.isVisible=!0,i.isEmpty=this.isEmpty.call(this,i),i.timeStart=(new Date).valueOf(),i.timeoutID=window.setTimeout(function(){t.sendData(t.completeData(i,{type:"oneSecView",time:t.round(t.viewAbilityTime*t.secondsFactor,2),counter:i.oneSecViewCounter+=1}))},this.viewAbilityTime)}handleDisappearedElement(e){const t=e;t.isVisible=!1,t.timeStop=(new Date).valueOf(),t.elapsedTime=this.round((t.timeStop-t.timeStart)*this.secondsFactor,2),clearTimeout(t.timeoutID),this.sendData(this.completeData(t,{type:"fullTimeView",counter:t.fullTimeViewCounter+=1}))}updateNodes(){if(this.nodesList.length){void 0===this.lastScrollPosY&&this.updateScrollPosY();for(let e,t,i=this.nodesList.length-1;i>=0;i--)(e=this.nodesList[i])&&this.isVisible(e)&&((t=this.isNearViewport(e))&&!e.isVisible?this.handleAppearedElement(e,i):!t&&e.isVisible&&this.handleDisappearedElement(e,i))}this.isWorking=!1}onScroll(){this.updateScrollPosY(),this.isWorking||(this.isWorking=!0,this.fnRequestAnimationFrame.call(window,this.updateNodes.bind(this)))}onBeforeUnload(){this.updateScrollPosY(-1e6),this.isWorking||(this.isWorking=!0,this.updateNodes())}handlePageVisibilityChange(e){return"boolean"==typeof e?e?this.onPageVisible():this.onPageHidden():document[this.hiddenPropertyName]?this.onPageHidden():this.onPageVisible()}onPageHidden(){return this.isPageVisible?(this.isPageVisible=!1,this.updateScrollPosY(-1e6),this.isWorking||(this.isWorking=!0,this.updateNodes()),this.isPageVisible):this.isPageVisible}onPageVisible(){return this.isPageVisible?this.isPageVisible:(this.isPageVisible=!0,this.updateScrollPosY(),this.isWorking||(this.isWorking=!0,this.updateNodes()),this.isPageVisible)}getHiddenPropertyName(e){return e?`${e}Hidden`:"hidden"}getVisibilityEvent(e){return e?`${e}visibilitychange`:"visibilitychange"}getBrowserPrefix(){for(let e=0;e<this.browserPrefixes.length;e++)if(this.getHiddenPropertyName(this.browserPrefixes[e])in document)return this.browserPrefixes[e];return null}observeNodes(){const e=document.querySelectorAll(`[${this.attributeName}]`);for(let t=0;t<e.length;t++)this.observe(e[t]);this.sendData({viewAbilityNodesList:JSON.stringify(this.nodeIdsList)})}observe(e){return!!e&&(this.setInitialProperties(e),this.nodesList.push(e),this.nodeIdsList.push(e.getAttribute(this.attributeName)),!0)}completeData(e,t){const i=e,s=t;try{i.getAttribute(this.attributeName)&&(s.name=i.getAttribute(this.attributeName)),!t.time&&i.elapsedTime&&(s.time=i.elapsedTime),s.width=i.offsetWidth?i.offsetWidth:0,s.height=i.offsetHeight?i.offsetHeight:0,s.startWidth=i.startWidth?i.startWidth:0,s.startHeight=i.startHeight?i.startHeight:0,s.isEmpty=n.e(i.isEmpty)&&!isNaN(i.isEmpty)?Number(i.isEmpty):0}catch(e){window.Inpl.Log.log(e,0,"iwa2_err")}return s}sendData(e){if(!n.e(e)||!n.i(e))return;const t=new s.a;for(const[i,s]of n.m(e))t.set(i,s,"page");if(window.CustomEvent){const e=new window.CustomEvent("viewabilitySend",{detail:t.get()});window.dispatchEvent(e)}this.tracker.send(["event","viewability",{customVariables:t}])}debounce(e,t,i){let s;return function(){const n=this,o=[e,t,i];s?clearTimeout(s):i&&e.apply(n,o),s=setTimeout(function(){i||e.apply(n,o),s=null},t||100)}}round(e,t){const i=Math.pow(10,t),s=e*i;return Math.round(s)/i}}}}]);